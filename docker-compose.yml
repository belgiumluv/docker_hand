services:
  vpn:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vpn_all_in_one
    restart: unless-stopped
    volumes:
      - ./vpn:/vpn
      - ./data:/data
      - ./ssl:/opt/ssl
      - ./configs/haproxy.cfg:/etc/haproxy/haproxy.cfg:rw
      - ./configs:/app/configs:ro
      - ./configs/masq_domain_list.json:/vpn/masq_domain_list.json:ro
      
    environment:
      - EMAIL=zastawa777@gmail.com
      - DUCKDNS_TOKEN=660b72b3-dcda-41ec-908a-d4a0e7d0e02a

      # можно не задавать DOMAINS, если 04_setconfiguration.py пишет /vpn/domain.txt
      # но если хочешь явно:
      # - DOMAINS=my-node.duckdns.org

      - RENEW_INTERVAL=21600
      - RENEW_BEFORE_DAYS=30
      - CONFIGS_DIR=/app/configs
      - VPN_DIR=/vpn
      - DB_PATH=/var/lib/bd/bd.db
      # если есть ssl:
      # - ./vpn/ssl:/vpn/ssl:ro
    ports:
      - "443:443"              # поменял с 443:443, чтобы на Windows не конфликтовало
      - "8080:8080"
      - "80:80"
      - "9090:9090"
      - "9100:9100"
      - "50062:50062"
      - "55851:55851"
      - "44405:44405"
